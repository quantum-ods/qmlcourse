---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

(mixedstates)=

# Смешанные состояния и матрицы плотности

## Описание лекции

Из этой лекции мы узнаем:

- Что такое матрица плотности
- Как ввести в описание квантовых состояний новый уровень случайности
- Как связаны смешанные (mixed) и запутанные (entangled) состояния
- Как можно описать насколько "сильно" квантовое состояние является смешанным

## Смешанные состояния

Эта глава кратко рассматривает довольно сложный, но крайне важный аспект квантового описания мира: как описать квантовую систему, в которой случайным является не только результат измерения, но и само состояние квантовой системы, иными словами, когда мы не можем описать квантовую систему определенным вектором состояния.

Как могут появиться такие ситуации?

Прежде всего, в любой реалистичной ситуации квантовая система будет испытывать влияние окружающей среды. Это воздействие окружающей среды на квантовый компьютер, как правило, может быть охарактеризовано некоторой температурой этой самой среды, и скоростью термализации системы с ней. В отличие от классических компьютеров, где шумы редко приводят к ошибкам в вычислениях, квантовые компьютеры очень плохо защищены от шумов. Любое масштабное квантовое вычисление является гонкой с процессами декогеренции и релаксации: за время выполнения алгоритма шумы не должны испортить результат вычислений настолько, чтобы его нельзя было использовать.

Вторая, более важная причина использования смешанных состояний состоит в их тесной связи с запутанными состояниями, как показано ниже.

## Почему нельзя обойтись волновой функцией

Рассмотрим реальный физический кубит в состоянии равновесия, например, спин ядра атома в магнитном поле.
Статистическая физика говорит нам, что вероятность обнаружить этот спин ориентированным вдоль внешнего поля выше, чем в
противоположном полю направлении. Для расчета отношений этих вероятностей можно использовать распределение Больцмана:
$p_\uparrow/p_\downarrow = e^{\frac{2\mu \Delta H}{k_\mathrm{B}T}}$, где $2\mu \Delta H$ -- разность энергий состояний со спином вдоль
поля и в противоположном полю направлений, $k_B$ -- постоянная Больцмана, а $T$ -- температура. Так как состояний у этой
системы всего два, сумма их вероятностей должна давать единицу: $p_\uparrow + p_\downarrow = 1$. Таким образом,
вероятности состояний однозначно определены.

Волновую функцию, отвечающую такому тепловому состоянию, можно записать в виде

$$
\ket{\psi} =
\begin{pmatrix}
\sqrt{p_\uparrow} \\
\sqrt{p_\downarrow}e^{i\phi}
\end{pmatrix},
$$

где значение фазы $\phi$ не определено. Однако $\phi$ определяет поведение системы не в меньшей мере, чем вероятности
$p_\uparrow$ и $p_\downarrow$. $\phi$ может равновероятно принимать любые значения. Таким образом, уже даже состояние
теплового равновесия нельзя описать одной волновой функцией -- это будет распределением вероятности по волновым
функциям с разным $\phi$.

## Матрица плотности

Оказывается, что вместо распределения вероятностей по волновым функциям можно использовать более простую
конструкцию -- матрицу плотности. Если система находится в состояниях $\Phi_n$ с вероятностями $p_n$, то матрицу
плотности можно определить как

$$
\rho = \sum\limits_{n}p_n \ket{\Phi_n}\bra{\Phi_n}.
$$ (eqn:rho_mixed)

Выражение $\ket{\Phi_n}\bra{\Phi_n}$ обозначает произведение вектора-столбца на вектор-строку -- результатом будет
матрица. Важно, что значение любой ожидаемой величины (отвечающей оператору $\hat{A}$) можно записать через $\rho$:

$$
\mathbb{E}[A] = \sum\limits_{n}p_n \bra{\Phi_n}\hat{A}\ket{\Phi_n} =
\sum\limits_{n}p_n \operatorname{Tr}\left[\ket{\Phi_n}\bra{\Phi_n}\hat{A}\right] = \operatorname{Tr}\left[\rho \hat{A}\right]
$$

Математическое обоснование этой циклической перестановки можно получить, расписав матричные произведения покомпонентно:

$$
\bra{\Phi_n}\hat{A}\ket{\Phi_n} = \sum \limits_{i,j} \Phi_n^{i*} A_{ij} \Phi_n^{j} =
\operatorname{Tr}\left[\ket{\Phi_n}\bra{\Phi_n}\hat{A}\right].
$$

Любую наблюдаемую физическую величину можно выразить в виде ожидаемой величины некоторого эрмитова оператора --
а значит, описание с помощью матрицы плотности является универсальным для любых случайных квантовых систем.

Стоит заметить, что матрица плотности для подсистем была впервые введена в научный оборот знаменитым советским физиком, лауреатом Нобелевской премии Львом Ландау. {cite}`howtounderstandqm`

```{figure} /_static/qcblock/mixedstates/Landau.jpg
:name: landau

Лев Ландау, 1908-1968
```

## Чистые и смешанные состояния

Состояния, которые описываются одной единственной волновой функцией $\Psi$, называются _чистыми_ (англ. _pure states_).
Для таких состояний выражение для матрицы плотности получается тривиальным:

$$
\rho = \ket{\Psi}\bra{\Psi}
$$ (eqn:rho_pure)

Матрица плотности чистого состояния является _оператором-проектором_: действие оператора на волновую функцию произвольного состояния $\Phi$
 дает проекцию $\Phi$ на $\Psi$.
Состояния, которые нельзя описать одним вектором состояния, а можно лишь матрицей плотности, называются _смешанными_
(англ. _mixed states_).

### Чистота состояния

Можно легко показать, для оператора-проектора {eq}`eqn:rho_pure` выполняется тождество

$$
\rho^2 = \ket{\Psi} \bra{\Psi} \ket{\Psi} \bra{\Psi} = \ket{\Psi} \bra{\Psi} = \rho
$$

и следовательно, для чистого состояния

$$
\operatorname{Tr} (\rho^2) = 1
$$

(напомним, что мы всегда считаем вектора состояния нормированными на единицу).

Аналогичным образом, но после более длинных выкладок можно показать, что в общем случае

$$
\operatorname{Tr} (\rho^2) \leq 1,
$$

причем знак равенства в последней формуле возможен, только если в формуле {eq}`eqn:rho_mixed` сумма имеет лишь одно
слагаемое (т.е. состояние является чистым). Последнее свойство матрицы плотности позволяет ввести ряд величин,
характеризующих смешанные и запутанные состояния, как будет рассказано в заключительном разделе этой лекции.
Величина

$$
\gamma = \operatorname{Tr} (\rho^2)
$$  (eqn:purity)

называется _чистотой состояния_, или, на английском -- _quantum state purity_.

### Энтропия

Энтропия фон Неймана -- это другая численная характеристика того, насколько сильно наша система смешанная. Ее
выражение очень похоже на выражение для классической [энтропии Шеннона](https://ru.wikipedia.org/wiki/Информационная_энтропия).
Только в отличие от классики, в квантовой механике мы имеем _матрицу_ плотности, поэтому в выражении у нас
фигурирует [матричный логарифм](https://en.wikipedia.org/wiki/Logarithm_of_a_matrix):

$$
S = -Tr(\rho\cdot \ln(\rho))
$$ (eqn:entropy)

### Спектральная декомпозиция матрицы плотности

Определение матрицы плотности {eq}`eqn:rho_mixed` представляет собой сумму матриц плотностей чистых состояний, взятых с
некоторыми вероятностями. Интересно, что совершенно разным комбинациям чистых состояний могут соответствовать одинаковые
матрицы плотности. Например, состояние кубита, который с вероятностью 50% находится в состоянии $\ket{0}$ и с
вероятностью 50% в состоянии $\ket{1}$ совершенно неотличимо от такой же равновероятной смеси состояний $\ket{+}$ и
$\ket{-}$:

$$
\frac{1}{2}\left(\ket{0}\bra{0} + \ket{1}\bra{1}\right) =
\begin{pmatrix}\frac{1}{2} & 0 \\ 0 & \frac{1}{2}\end{pmatrix} =
\frac{1}{2}\left(\ket{+}\bra{+} + \ket{-}\bra{-}\right)
$$

Соотношение {eq}`eqn:rho_mixed` также можно рассматривать как спектральную декомпозицию матрицы плотности. В этом случае
состояния $\Psi_n$ образуют ортонормированный базис, а вероятности $p_n$ -- это собственные значения $\rho$.
Как чистота {eq}`eqn:purity`, так и энтропия {eq}`eqn:entropy` зависят лишь от этих собственных значений.

## Смешанные состояния и запутанность

Рассмотрим ситуацию, когда описываемую квантовую систему $\Phi$ можно разделить на две подсистемы,
$\phi$ и $\psi$, и состояние этой системы $\ket{\Phi}$ является суперпозицией состояний двух подсистем:

$$
\ket{\Phi} = \sum_{i,j} c_{i,j} \ket{\phi_i} \ket{\psi_j}.
$$

Здесь два ортонормированных набора векторов состояния $\ket{\phi_i}$ и $\ket{\psi_j}$ описывают две части всей системы.
Для такого состояния не всегда можно сказать, в каком именно состоянии находится каждая подсистема.

```{note}
Вспомним обсуждение кота Шредингера в [лекции про кубит](qubit) -- упрощая до предела, можно считать,
что радиоактивный атом является одной системой, а несчастный кот -- второй.

До измерения ни атом, ни кот не имеют определенного состояния, а находятся в суперпозиции возможных состояний.
```

Что же мы можем сделать, если у нас есть доступ лишь к одной из двух подсистем, а измерить состояние второй мы уже не
можем? В таком случае, все наши наблюдаемые величины будут отвечать операторами $A_\psi$, которые
действует _только_ на вторую подсистему. В примере кота Шредингера можно допустить, что экспериментально
пронаблюдать мы можем лишь состояние кота, а состояние радиоактивного атома недоступно нам для измерения. В таком случае
состояние второй подсистемы можно полностью описать используя _редуцированную_
матрицу плотности. Редуцированная матрица плотности получается из матрицы плотности чистого состояния всей системы
суммированием по вероятностям различных состояний первой подсистемы:

$$
\rho_\psi = \operatorname{Tr}_\phi (\ket{\Phi} \bra{\Phi}) = \sum_{i, j} d_{i, j} \ket{\psi_j} \bra{\psi_i},
$$ (eqn:partial-dm)

где

$$
d_{i, j} = \sum_k c_{j, k} c^{*}_{i, k},
$$

а $\operatorname{Tr}_\phi$ означает частичный след по второй подсистеме, звездочка -- комплексное сопряжение. В таких обозначениях значение для среднего от оператора $A$ вычисляется по формуле

$$
\braket{A_\psi} = \operatorname{Tr}_\psi (A \rho_\psi)
$$

Здесь след матрицы уже вычисляется по первой подсистеме.

Чаще всего при обсуждении смешанных состояний рассматривают только одну “подсистему”, считая, что вторая – это некоторый
макроскопический объект (“резервуар”, например лаборатория или даже вся Вселенная).
В этом случае определение матрицы плотности {eq}`eqn:rho_mixed` можно рассматривать как редуцированную матрицу плотности
{eq}`eqn:partial-dm`, из которой убрали нерелевантные и неконтролируемые степени свободы.

### Запутанные и сепарабельные состояния

Давайте вернемся к представлению состояния составной системы и зададимся вопросом: что можно сказать о связи между частями системы с точки зрения квантового описания? Для системы из двух кубитов такая составная система в общем случае может быть записана в явном виде (в этом разделе мы в основном следуем изложению из книги {cite}`valievkokin`):

$$
\ket{\Phi} = a \ket{0_A 0_B} + b \ket{0_A 1_B} + c \ket{1_A 0_B} + d \ket{1_A 1_B},
$$ (eqn:two_qubit)

где индексы $A$ и $B$ здесь обозначают первый и второй кубиты, соответственно, а условие нормировки дает

$$
\left\langle \Phi \middle| \Phi \right\rangle = |a|^2 + |b|^2 + |c|^2 + |d|^2 = 1.
$$

Теперь, как можно показать, состояние типа {eq}`eqn:two_qubit` может быть представлено в виде произведения состояний двух отдельных кубитов, если $ad = dc$:

$$
\ket{\Phi_s} = \left(a_A \ket{0_A} + b_A \ket{1_A} \right) \otimes \left(a_B \ket{0_B} + b_B \ket{1_B} \right),
$$

где для выражения {eq}`eqn:two_qubit`

$$
\begin{array}{cc} a = a_A a_B & b = a_A b_B \\ c = b_A a_B & d = b_A b_B \end{array}
$$

В других случаях, когда $ad \neq dc$, состояние составной системы не представимо в виде произведения состояний подсистем, такие состояния называют несепарабельными (nonseparable). Другими словами, результат измерения состояния подсистемы $A$ будет зависеть от состояния подсистемы $B$. Это означает, что для квантовых систем возможна нелокальная корреляция. Такое свойство квантовых систем называется _запутыванием_ (_entanglement_), а сами состояния _запутанными_ (_entangled_).

```{note}
В отличие от анлийского языка, в русском языке не сложилось единой терминологии в отношении запутанных состояний. На момент написания этой лекции (осень 2021 года) в статье [Квантовая запутанность](https://ru.wikipedia.org/wiki/Квантовая_запутанность) русскоязычной Википедии указывается восемь (!) отличающихся терминов для этого явления, например, "запутанность", "перепутанность" или "сцепленность". Сделать с этим что-то сложно, остается только иметь в виду имеющиеся обстоятельства. Мы будем стараться употреблять термин _запутанность_ и, соответственно, _запутанные_ состояния.
```

Приведем пару примеров запутанных состояний:

1. $b = c = 0, a = d = \pm 1/\sqrt{2}$ -- состояние "_шредингеровского кота_", см. {cite}`valievkokin` и {cite}`mogilevtsevkilin`, такая формула для вектора состояния возникает для суперпозиции двух макроскопически различимых состояний одной из подсистем, например, живой или мертвый кот.
2. $a = d = 0, b = -c = \pm 1/\sqrt{2}$ -- такое состояние называется ЭПР-парой (EPR, от Einstein-Podolsky-Rosen) и это очень важный пример из истории изучения запутанности в квантовой физике.

```{note}
в 1930-е происходили многочисленные споры об "интерпретации" (сути) квантовой механики. Именно тогда Эйнштейн, Шредингер и их коллеги обратили внимание на несепарабельные состояния и затем Эйнштейном, Подольским и Розеном был сформулирован "парадокс" -- что квантовая механика либо нелокальна (т.е. несовместима с теорией относительности), либо неполна (мы учитываем не все параметры при описании состяния квантовых систем). Именно с дискуссией о сути запутанности связана знаменитая цитата Эйнштейна "Бог не играет в кости" и менее известный ответ Нильса Бора, "Альберт, не указывай Богу, что ему делать."
```

Довольно долго изучение запутанности и связанных с ней трудностей считались сложным, но неосновными вопросами квантовой физики. Но с развитием квантовой информатики стало понятно, что без запутанности нельзя разрабатывать квантовые компьютеры и системы квантовой связи. В настоящее время существуют устоявшиеся методы создания запутанных состояний в эксперименте. А для целей нашего курса, в симуляциях, достаточно использовать [двухкубитные гейты](../qcblock/gates.html#id15), которые обсуждались в предыдущей лекции, например `CNOT` или `CZ`, который используется в лекции про [Градиенты квантовых схем](gradients).

В качестве примера давайте посмотрим, как можно создать запутанное состояние в `PennyLane`. Начнем с импортов и создания двухкубитной схемы:

```{code-cell} ipython3
import pennylane as qml
from pennylane import numpy as np

dev = qml.device("default.qubit", wires=2)
```

Далее применим к первому кубиту операцию поворота $\hat{RX}$, запутаем кубиты с помощью $\hat{CNOT}$ и далее оценим запутанность с помощью измерения оператора Паули $\hat{\sigma^z}$:

```{code-cell} ipython3
@qml.qnode(dev)
def circuit(param):
    qml.RX(param, wires=0)
    qml.CNOT(wires=[0, 1])
    return qml.expval(qml.PauliZ(0)), qml.expval(qml.PauliZ(1))
```

В этом примере значение переменной `param` определяет степень запутанности, и для $\pi/2$ запутанности будет максимальна, в результате оба кубита будут максимально смешанными и средний результат измерения будет нулевым:

```{code-cell} ipython3
print(circuit(np.pi / 2))
```

(код взят из официальной [демонстрации](https://pennylane.ai/qml/demos/tutorial_advanced_usage.html) для библиотеки `PennyLane`)

## Описания эволюции смешанного состояния

### Квантовая динамика

Напомним, что квантовая динамика в терминах волновых функций $\ket{\Psi}$ описывается при помощи уравнения Шредингера:

$$
i\hbar \frac{\partial \Psi(x, t)}{\partial t} = \hat{H} \Psi(x, t)
$$

Аналогичное уравнение можно получить и для матриц плотности. Оно называется уравнением фон Неймана и записывается через
коммутатор $[]$, который определен как $[\hat{A}, \hat{B}] = \hat{A}\hat{B} - \hat{B}\hat{A}$:

$$
i\hbar \frac{\partial \rho}{\partial t} = [\hat{H}, \rho]
$$

Аналогично, если действие каких-то унитарных операций изменяет вектор состояния $\ket{\Psi}$ на
$\hat{U} \ket{\Psi}$, то матрицу плотности оно должно изменять как

$$
\sum\limits_{n} p_n \hat{U} \ket{\Psi_n} \bra{\Psi_n} \hat{U}^\dagger = \hat{U}\rho\hat{U}^\dagger.
$$

Важное свойство унитарных матриц -- их собственные значения по модулю равны единице. Действие унитарного оператора не
изменяет собственных значений матрицы плотности, но вращает собственный ее базис. Исходя из этого можно сделать вывод о
том, что ни чистота, ни энтропия не могут изменяться под в результате унитарных операций.

### Измерения и томография

Квантовая механика работает так, что любое [измерение](../qcblock/qubit.html#id23) приводит к коллапсу волновой функции
и является необратимым. А еще измерения, например, состояния $\ket{+}$ и $\ket{-}$ не различимы при измерениях по оси
$\mathbf{Z}$ -- для обоих состояний мы будем получать $\ket{1}$ и $\ket{0}$ с вероятностью $0.5$, то есть нам нужно
измерять по _всем_ базисам. В общем, получается, что восстановить амплитуду и фазу волновой функции $\Psi$ это большая
проблема, если добавить сюда вероятностный характер измерения.

```{note}
Строго говоря это не просто "большая" проблема, а настоящая NP-полная задача оптимизации!
```

```{figure} /_static/qcblock/mixedstates/MarginalDistribution.png
:width: 250px

Иллюстрация фазовой проблемы.
```

Эта задача обычно решается при помощи квантовой томографии, и восстанавливают как раз не волновую функцию $\Psi$,
а матрицу плотности $\rho$  (потому что в реальных экспериментах и задачах почти не бывает чистых состояний).
Представим, что наша квантовая система описывается базисом $y_i$ -- набором из $2^N$ векторов, причем каждому из этих
базисных векторов соответствует свое собственное значение -- результат измерения
(подробнее об этом было в [лекции про кубит](../qcblock/qubit.html#id31)).
Тогда если у нас будет достаточно много результатов измерений, то мы сможем восстановить нашу матрицу плотности
$\rho$ методом максимизации правдоподобия. Выражение для правдоподобия в этом случае можно записать как:

$$
L(\rho) = \prod_i \bra{y_i} \rho \ket{y_i} ^{q_i}
$$

где $q_i$ -- это частота получения собственного значения, соответствующего волновой функции $\ket{y_i}$
(потому что измерение переводит наше состояние в базисный вектор, соответствующий результату измерения).
В итоге увеличивая число измерений мы приближаем частоты $q_i$ к вероятностям $\bra{\Psi}(\ket{y_i}\bra{y_i})\ket{\Psi}$, а нашу матрицу $\rho$ к ее истинному виду.

Методы квантовой томографии являются критической частью, в том числе, квантовой связи, так как системы там обычно небольшие, но восстанавливать надо всю матрицу плотности.

## Что мы узнали?

- Формализм матрицы плотности позволяет описывать составные системы (например, один кубит в многокубитной системе)
- Чаще всего в реальных экспериментах у нас ситуация "мы приготовили состояние, но точно не знаем какое" и волновая функция нам не подходит
- Что такое квантовая запутанность и как ее можно описать
- Состояние части запутанного состояния -- смешанное
- Отличие смешанного состояния от чистого можно охарактеризовать параметром типа энтропии
